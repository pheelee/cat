<!DOCTYPE html>
<html lang="en">
  <head>
      <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
      <title>Cat - cloud authentication tester</title>
      <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="/static/materialize.min.css">
      <link rel="stylesheet" href="/static/app.css">
  </head>
  <body class="no-scrollbar" data-workflow="{{.Workflow}}" data-step="{{.Step}}">
    <header>
        <nav class="blue darken-3">
            <div class="nav-wrapper">
              <a href="/" class="brand-logo">
                <img style="margin-top:8px;margin-left: 8px;" src="data:image/png;base64,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">
                <span style="height:100%; vertical-align: top;">Cat</span>
                <span class="light-blue-text text-accent-1" style="height:100%; vertical-align:top ;font-size:1rem;">cloud authentication tester</span>
              </a>
              <a href="#" data-target="mobile-menu" class="sidenav-trigger"><i class="material-icons">menu</i></a>
              <ul class="right hide-on-med-and-down">
                <li id="wf-selector-oidc"><a href="/oidc">OIDC</a></li>
                <li id="wf-selector-saml"><a href="/saml" id="wf-saml" >SAML</a></li>
              </ul>
            </div>
          </nav>
        
          <ul class="sidenav" id="mobile-menu">
            <li class="active"><a href="#">OIDC</a></li>
            <li><a href="#">SAML</a></li>
          </ul>
    </header>
      <main class="">
      {{if .Error}}
      <div id="error" class="container">
        <div class="row">
          <div class="col s12">
            <div class="card red lighten-1">
              <div class="card-content white-text">
                <span class="card-title">Error</span>
                <p>{{.Error}}</p>
              </div>
            </div>
          </div>
        </div>
      </div>
      {{end}}
      {{if eq .Workflow "oidc"}}
      <div id="oidcWorkflow" class="container workflow">
          <div class="row">
            <ul class="collapsible">
                <li class="active">
                  <div class="collapsible-header"><i class="material-icons">settings</i>Parameters</div>
                  <div class="collapsible-body">
                      <div class="row">
                        <form class="col s12" action="/oidc/setup" method="POST">
                          <input type="hidden" name="csrf_token" value="{{.CsrfToken}}">
                            <div class="row">
                              <div class="col s12 m3">
                                <span>Response type</span>
                              </div>
                              <div class="col s12 m3">
                                <label>
                                  <input type="checkbox" class="filled-in response-type-selector persist" checked="checked" name="code" />
                                  <span>code</span>
                                </label>
                              </div>
                              <div class="col s12 m3">
                                <label>
                                  <input type="checkbox" class="filled-in response-type-selector persist" name="token" />
                                  <span>token</span>
                                </label>
                              </div>
                              <div class="col s12 m3">
                                <label>
                                  <input type="checkbox" class="filled-in response-type-selector persist" name="id_token" />
                                  <span>id_token</span>
                                </label>
                              </div>
                            </div>
                            <div class="row response-type">
                              <div class="title">
                                Authorization code flow
                              </div>
                              <div class="description">
                                The IdP responds with a code which can be exchanged for tokens
                              </div>
                            </div>
                            <div class="row">
                              <div class="input-field col s12 m6">
                                <input id="provider" name="provider" type="text" class="validate persist" value="{{.OidcData.ProviderURL}}">
                                <label for="provider">Provider URL</label>
                                <span class="helper-text"></span>
                              </div>
                              <div class="input-field col s12 m6">
                                  <input id="redir" name="redir" type="text" disabled class="validate" value="{{.OidcData.RedirectURL}}">
                                  <label for="redir">Redirect URI</label>
                                  <span class="helper-text"></span>
                              </div>
                              <div class="input-field col s12 m6">
                                  <input id="app" name="app" type="text" class="validate persist" value="{{.OidcData.AppID}}">
                                  <label for="app">Application ID</label>
                                  <span class="helper-text"></span>
                              </div>
                              <div class="input-field col s12 m6">
                                  <input id="secret" name="secret" type="text" class="validate persist" value="{{.OidcData.ClientSecret}}">
                                  <label for="secret">Client Secret</label>
                                  <span class="helper-text"></span>
                              </div>
                              <div class="input-field col s12 m6">
                                <input id="scope" name="scope" type="text" class="validate persist" value="{{.OidcData.Scope}}">
                                <label for="scope">OIDC Scopes</label>
                                <span class="helper-text">separated by spaces e.g "openid profile email"</span>
                            </div>
                              <button class="btn waves-effect waves-light blue darken-1" type="submit">Start Flow
                                <i class="material-icons right">send</i>
                              </button>
                            </div>
                        </form>
                      </div>
                  </div>
                </li>
                <li>
                  <div class="collapsible-header"><i class="material-icons">vpn_key</i>Tokens</div>
                  <div class="collapsible-body">
                    <div class="row">
                      <div class="col m12 s12">
                        <span class="token-title blue-text accent-3-text">Access Token</span>
                        <div class="row">
                          <pre class="token">{{.OidcData.AccessToken}}</pre>
                        </div>
                      </div>
                      <div class="col m12 s12">
                        <span class="token-title blue-text accent-3-text">ID Token</span>
                        <div class="row">
                          <pre class="token">{{.OidcData.IDToken}}</pre>
                        </div>
                      </div>
                      <div class="col m12 s12">
                        <span class="token-title blue-text accent-3-text">Userinfo</span>
                        <div class="row">
                          <pre class="token">{{.OidcData.UserInfo}}</pre>
                        </div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col s12 m12" style="text-align:center">
                        <button class="btn waves-effect waves-light blue darken-1" onclick="location.href='/oidc/restart'">Restart Flow
                          <i class="material-icons right">send</i>
                        </button>
                      </div>
                    </div>
                  </div>
                </li>
              </ul>
          </div>
      </div>
      {{end}}
      {{if eq .Workflow "saml"}}
      <div id="samlWorkflow" class="container workflow">
        <div class="row">
          <ul class="collapsible">
            <li class="active">
              <div class="collapsible-header"><i class="material-icons">settings</i>Parameters</div>
              <div class="collapsible-body">
                <div class="row">
                  <div class="col s12 m12">
                    <div class="switch">
                      <label>
                        Basic Mode
                        <input type="checkbox" class="toggler persist" name="toggler" data-target="saml-expertMode,certificate" value="off">
                        <span class="lever"></span>
                        Expert Mode
                      </label>
                    </div>
                  </div>
                </div>
                <div class="row">
                  <form class="col s12" id="samlForm" method="POST" action="/saml/setup">
                    <input type="hidden" name="csrf_token" value="{{.CsrfToken}}">
                    <div class="row">
                      <div class="input-field col s12 m12">
                        <input id="metadata" name="metadata" type="text" class="validate persist" value="{{.SamlData.IDPMetadataURL}}">
                        <label for="metadata">IdP Metadata URL</label>
                        <span class="helper-text"></span>
                      </div>
                      <div class="input-field col s12">
                        <textarea id="metadatafile" class="materialize-textarea persist" name="metadatafile"></textarea>
                        <label for="metadatafile">Metadata</label>
                      </div>
                      <div class="input-field col s12 m12">
                        <input id="sp_meta" name="sp_meta" type="text" class="validate" disabled value="{{.SamlData.SPMetadataURL}}">
                        <label for="sp_meta">Service Provider Metadata URL</label>
                        <span class="helper-text">give this url to the IdP</span>
                      </div>
                    </div>
                    <div id="saml-expertMode" class="hidden">
                      <div class="row" >
                        <div class="col s12 m12 section"><span>Request Signing</span></div>
                        <div class="col s12 m6"><label><input class="persist" type="checkbox" name="signRequest" checked/><span>Sign Request with Algorithmus</span></label></div>
                        <div class="col s12 m6">
                          <label><input class="with-gap" type="radio" name="sigAlg" value="http://www.w3.org/2000/09/xmldsig#rsa-sha1" /><span>SHA1</span></label>
                          <label><input class="with-gap" type="radio" name="sigAlg" value="http://www.w3.org/2001/04/xmldsig-more#rsa-sha256" checked/><span>SHA256</span></label>
                          <label><input class="with-gap" type="radio" name="sigAlg" value="http://www.w3.org/2001/04/xmldsig-more#rsa-sha512" /><span>SHA512</span></label>
                        </div>
                      </div>
                      <div class="row" >
                        <div class="col s12 m12 section"><span>Other Options</span></div>
                        <div class="col s12 m6"><label><input class="persist" type="checkbox" name="NoEncryptionCertificate" /><span>Remove Encryption Certificate from Metadata</span></label></div>
                        <div class="col s12 m6"><label><input class="persist" type="checkbox" name="AllowIDPInitiated" /><span>Allow IdP Initiated SignOn</span></label></div>
                      </div>
                      <div class="row">
                        <div class="col s12 m12 section"><span>Attributes</span></div>
                        <div class="input-field col s12">
                          <select name="nameIDFormat" class="persist">
                            <option value="urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified">urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified</option>
                            <option selected value="urn:oasis:names:tc:SAML:2.0:nameid-format:transient">urn:oasis:names:tc:SAML:2.0:nameid-format:transient</option>
                            <option value="urn:oasis:names:tc:SAML:2.0:nameid-format:persistent">urn:oasis:names:tc:SAML:2.0:nameid-format:persistent</option>
                            <option value="urn:oasis:names:tc:SAML:1.1:nameid-format:emailAddress">urn:oasis:names:tc:SAML:1.1:nameid-format:emailAddress</option>
                          </select>
                          <label>NameID Format</label>
                        </div>
                      </div>
                    </div>
                    <button class="btn waves-effect waves-light blue darken-1" type="submit">Create Service Provider
                      <i class="material-icons right">save</i>
                    </button>
                    <button class="btn waves-effect waves-light blue darken-1" type="button" id="startbtn" onclick="location.href = '/saml/callback'">Start
                      <i class="material-icons right">send</i>
                    </button>
                  </form>
                  <div class="row">
                    <div class="col s12 m12">
                      <p class="note">NameID Format must be <b><span id="nameid">urn:oasis:names:tc:SAML:2.0:nameid-format:transient</span></b></p>
                    </div>
                  </div>
                  <div class="row">
                    {{range .SamlData.SetupInstructions}}
                    <div class="col s12">
                      <div class="setupinstruction-title">{{.Title}}</div>
                      <pre class="setupinstruction-content">{{.Content}}</pre>
                    </div>
                    {{end}}
                  </div>
                </div>
              </div>
            </li>
            <li>
              <div class="collapsible-header"><i class="material-icons">vpn_key</i>Token</div>
              <div class="collapsible-body">
                <div class="row">
                  <div class="col m12 s12">
                    <div class="row">
                      <pre class="token">{{.SamlData.Token}}</pre>
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col s12 m12" style="text-align:center">
                    <button class="btn waves-effect waves-light blue darken-1" onclick="location.href='/saml/restart'">Restart Flow
                      <i class="material-icons right">send</i>
                    </button>
                  </div>
                </div>
            </li>
            <li id="certificate" class="hidden">
              <div class="collapsible-header"><i class="material-icons">lock</i>Certificate</div>
              <div class="collapsible-body">
                <span class="token-title blue-text accent-3-text">Certificate</span>
                <div class="row">
                  <pre>{{.SamlData.Certificate}}</pre>
                </div>
                <span class="token-title blue-text accent-3-text">Raw</span>
                <div class="row">
                  <pre>{{.SamlData.CertRaw}}</pre>
                </div>
              </div>
            </li>
          </ul>
        </div>
      </div>
      {{end}}
    </main>
    <footer class="page-footer white">
      <div class="footer-copyright blue darken-3">
        <div class="container">
          <div class="row" style="margin-bottom:0;">
            <div class="col s4 m4">¬© 2021-2022 Philipp Ritter</div>
            <div class="col s4 m4"><span class="version">Commit: {{.Version}}</span></div>
            <div class="col s4 m4"><span class="grey-text text-lighten-4 right">made with ‚ù§Ô∏è and ‚òï in üá®üá≠</span></div>
          </div>
        </div>
      </div>
    </footer>
    <script src="/static/materialize.min.js"></script>
    <script src="/static/app.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function(){
          document.querySelector("#wf-selector-"+document.querySelector("body").dataset["workflow"]).classList.add("active");
          let step = document.querySelector("body").dataset["step"];
          let c = M.Collapsible.init(document.querySelector(".collapsible"),{});
          c.open(step);
          setTimeout(function(){document.querySelectorAll(".input-field").forEach(e => { 
            let el = e.querySelector("input");
            if (el == null){
              el = e.querySelector("textarea");
            }
            if (el.value != "") 
            {e.querySelector("label").classList.add("active")} })}, 1)
          M.FormSelect.init(document.querySelectorAll("select"), {});
          Form.Load(document.querySelectorAll(".persist"),"Form-"+document.querySelector("body").dataset["workflow"]);
          init(); // the saml/oidc specific js parts
      })
      document.querySelectorAll("pre.token").forEach(e => {
        if (e.innerText !== "") {
          e.innerHTML = token.json.prettyPrint(JSON.parse(e.innerText));
        }
      })
      document.querySelectorAll(".toggler").forEach(e=>{
        e.addEventListener("change", function(t){
          t.target.dataset.target.split(",").forEach(i => {
            document.querySelector("#"+i).classList.toggle("hidden");
          })
        })
      })
      document.querySelector("form").addEventListener("submit", function(e){
        e.preventDefault();
        Form.Save(document.querySelectorAll(".persist"), "Form-"+document.querySelector("body").dataset["workflow"])
        e.target.submit();
      })
    </script>
    {{if eq .Workflow "oidc"}}
    <script>
      function init(){
        document.querySelector("#redir").value = location.href.endsWith("/callback") ? location.href : location.href + "/callback";
        let scopeInput = document.querySelector("#scope")
        if (scopeInput.value === "") {scopeInput.value = "openid";}
        document.querySelectorAll(".response-type-selector").forEach(e => {
          e.addEventListener("change", function(){
            evalFlowStyle();
          })
        })
        evalFlowStyle();
      }
      function evalFlowStyle(){
        let code = document.querySelector(".response-type-selector[name='code']").checked;
        let token = document.querySelector(".response-type-selector[name='token']").checked;
        let id_token = document.querySelector(".response-type-selector[name='id_token']").checked;
        if(code && !token && !id_token) {
          document.querySelector(".response-type .title").innerHTML = "Authorization code flow"
          document.querySelector(".response-type .description").innerHTML = "The IdP responds with a code which can be exchanged for tokens. This is the most secure flow"
          document.querySelector("form button[type='submit']").disabled = false;
        }else if(code && (token || id_token)){
          document.querySelector(".response-type .title").innerHTML = "Hybrid flow"
          document.querySelector(".response-type .description").innerHTML = "The IdP responds with both a code (which can be exchanged for tokens) and a token"
          document.querySelector("form button[type='submit']").disabled = false;
        }else if(!code && token || id_token){
          document.querySelector(".response-type .title").innerHTML = "Implicit flow"
          document.querySelector(".response-type .description").innerHTML = "The IdP responds with an access and/or ID token. This is common for single-page-applications or application which directly need a token"
          document.querySelector("form button[type='submit']").disabled = false;
        }else{
          document.querySelector("form button[type='submit']").disabled = true;
        }
      }
    </script>
    {{end}}
    {{if eq .Workflow "saml"}}
    <script>
      function init(){
        document.querySelector("select[name='nameIDFormat']").addEventListener("change", function(t){
          document.getElementById("nameid").innerText = t.target.value;
        })
        document.querySelector("input[name='signRequest']").addEventListener("change", function(t){
          document.querySelectorAll("input[name='sigAlg']").forEach(e=>{
            e.toggleAttribute("disabled");
          })
        })
        document.querySelectorAll("input:not([name='toggler'],[type='hidden'])").forEach(e=>{
          e.addEventListener("change", function(){
            document.getElementById("startbtn").disabled = true;
          })
        })
        if(location.href.endsWith("/saml")){
          document.getElementById("startbtn").disabled = true;
        }
      }
    </script>
    {{end}}
  </body>
</html>